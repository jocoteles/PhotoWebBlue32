<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PhotoWebBlue32</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#2c3e50"/>
    <style>
        :root {
            --chart-height: 400px;
            --line-thickness: 2px;
            --trigger-thickness: 1px;
            --event-radius: 4px;
            --c1-color: #e74c3c; /* Vermelho */
            --c2-color: #f39c12; /* Laranja */
            --c3-color: #f1c40f; /* Amarelo */
            --c4-color: #2ecc71; /* Verde */
            --c5-color: #3498db; /* Azul */
            --c6-color: #9b59b6; /* Violeta */
        }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; margin: 0; background-color: #f4f4f9; color: #333; }
        .main-container { max-width: 900px; margin: 0 auto; background-color: #fff; padding: 15px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        h1, h2 { color: #2c3e50; text-align: center; margin-top: 0; }
        
        .top-nav { display: flex; margin-bottom: 20px; }
        .nav-btn { flex: 1; padding: 12px; font-size: 16px; border: none; cursor: pointer; transition: background-color 0.3s, color 0.3s; }
        .nav-btn.active { background-color: #34495e; color: white; }
        .nav-btn.inactive { background-color: #ecf0f1; color: #2c3e50; }

        .page-div { display: none; }
        .page-div.visible { display: block; }
        
        button { background-color: #3498db; color: white; border: none; padding: 10px 15px; border-radius: 5px; cursor: pointer; font-size: 16px; margin: 5px; transition: background-color 0.3s; }
        button:hover { background-color: #2980b9; }
        button:disabled { background-color: #bdc3c7; cursor: not-allowed; }
        
        .status { text-align: center; font-weight: bold; margin: 20px 0; padding: 10px; border-radius: 5px; }
        .status.disconnected { background-color: #e74c3c; color: white; }
        .status.connected { background-color: #2ecc71; color: white; }

        .control-group { margin-bottom: 20px; border-bottom: 1px solid #eee; padding-bottom: 15px; }
        label { display: block; margin-bottom: 8px; font-weight: bold; }
        input[type="range"], input[type="number"], input[type="text"] { width: 100%; box-sizing: border-box; padding: 8px; }
        
        #btn-trigger-reading { width: 100%; background-color: #2ecc71; margin-bottom: 15px; }
        #btn-trigger-reading.reading { background-color: #e74c3c; }
        
        #chart-container { position: relative; height: var(--chart-height); width: 100%; }
        
        .toggle-grid, .time-table { width: 100%; border-collapse: collapse; text-align: center; margin-top: 20px; }
        .toggle-grid th, .toggle-grid td, .time-table th, .time-table td { border: 1px solid #ddd; padding: 8px; }
        .toggle-grid th { background-color: #f2f2f2; }
        .toggle-grid .toggle-btn { width: 100%; padding: 8px 4px; border: 2px solid transparent; opacity: 0.5; }
        .toggle-grid .toggle-btn.enabled { opacity: 1; border-color: #34495e; }
        #toggle-c1, #toggle-s1, #toggle-d1 { background-color: var(--c1-color); }
        #toggle-c2, #toggle-s2, #toggle-d2 { background-color: var(--c2-color); }
        #toggle-c3, #toggle-s3, #toggle-d3 { background-color: var(--c3-color); }
        #toggle-c4, #toggle-s4, #toggle-d4 { background-color: var(--c4-color); }
        #toggle-c5, #toggle-s5, #toggle-d5 { background-color: var(--c5-color); }
        #toggle-c6, #toggle-s6, #toggle-d6 { background-color: var(--c6-color); }

        .config-item { display: flex; align-items: center; gap: 15px; }
        .config-item span { min-width: 50px; text-align: right; }
    </style>
</head>
<body>

    <div class="main-container">
        <h1>PhotoWebBlue32</h1>
        
        <nav class="top-nav">
            <button id="nav-btn-conexao" class="nav-btn">Conexão</button>
            <button id="nav-btn-canais" class="nav-btn">Canais</button>
            <button id="nav-btn-config" class="nav-btn">Config</button>
        </nav>

        <!-- DIV CONEXÃO -->
        <div id="div-conexao" class="page-div">
            <h2>Conexão</h2>
            <div id="status-bar" class="status disconnected">Desconectado</div>
            <div class="control-group">
                <button id="btn-connect">Conectar</button>
                <button id="btn-disconnect" disabled>Desconectar</button>
            </div>
            <p>Dispositivo conectado: <strong id="device-name-display">Nenhum</strong></p>
        </div>

        <!-- DIV CANAIS -->
        <div id="div-canais" class="page-div">
             <button id="btn-trigger-reading" disabled>Disparar Leitura</button>
             
             <div id="data-acquisition-section" style="display: none;">
                <h2>Gráfico de Níveis</h2>
                <div id="chart-container">
                    <canvas id="main-chart"></canvas>
                </div>

                <fieldset class="control-group" id="channels-fieldset" disabled>
                    <legend><h2>Seleção de Eventos</h2></legend>
                    <table class="toggle-grid">
                        <thead>
                            <tr>
                                <th><button class="toggle-btn" id="toggle-col-canal">Canal</button></th>
                                <th><button class="toggle-btn" id="toggle-col-subida">Subida</button></th>
                                <th><button class="toggle-btn" id="toggle-col-descida">Descida</button></th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- As linhas serão geradas por JS -->
                        </tbody>
                    </table>
                </fieldset>

                <h2>Tabela de Tempos</h2>
                <table class="time-table" id="events-table">
                    <thead>
                        <tr><th>Evento</th><th>Canal</th><th>Subida (ms)</th><th>Descida (ms)</th></tr>
                    </thead>
                    <tbody>
                        <tr><td colspan="4">Nenhum evento detectado.</td></tr>
                    </tbody>
                </table>
                 
                <div class="control-group" id="analysis-controls" style="display:none">
                    <button class="toggle-btn" id="btn-zero-origin">Zerar origem temporal</button>
                    <button class="toggle-btn" id="btn-show-events">Mostrar eventos no gráfico</button>
                </div>
                 
                <h2>Salvar Dados</h2>
                <div class="control-group" id="save-controls" style="display:none">
                    <label>Tabela de Tempos:</label>
                    <button id="btn-copy-times">Copiar</button>
                    <button id="btn-save-times">Salvar CSV</button>
                    <br><br>
                    <label>Dados do Gráfico:</label>
                    <button id="btn-save-graph">Salvar CSV</button>
                </div>
             </div>
        </div>

        <!-- DIV CONFIG -->
        <div id="div-config" class="page-div">
            <h2>Configurações</h2>
            <div class="control-group">
                <label for="line-thickness">Espessura da linha do canal: <span id="line-thickness-value">100%</span></label>
                <div class="config-item"><input type="range" id="line-thickness" min="20" max="200" value="100"></div>

                <label for="trigger-thickness">Espessura da linha de trigger: <span id="trigger-thickness-value">100%</span></label>
                <div class="config-item"><input type="range" id="trigger-thickness" min="20" max="200" value="100"></div>

                <label for="event-radius">Raio do marcador de evento: <span id="event-radius-value">100%</span></label>
                <div class="config-item"><input type="range" id="event-radius" min="20" max="200" value="100"></div>
                
                <label for="chart-height">Altura do gráfico: <span id="chart-height-value">100%</span></label>
                <div class="config-item"><input type="range" id="chart-height" min="20" max="200" value="100"></div>

                <label for="max-acquisition-time">Tempo máximo de aquisição (s):</label>
                <input type="number" id="max-acquisition-time" min="1" max="60" value="20">
            </div>

            <button id="btn-advanced" style="width: 100%;">Avançado</button>
            <div id="advanced-settings" style="display:none; margin-top: 15px; border: 1px solid #ccc; padding: 10px;">
                <label for="samples-per-chunk">Tamanho do buffer de leituras (1-100)</label>
                <input type="number" id="samples-per-chunk" min="1" max="100" value="20" disabled>
                
                <label for="sample-interval-us">Intervalo entre leituras (µs) (50-1000)</label>
                <input type="number" id="sample-interval-us" min="50" max="1000" value="250" disabled>
            </div>
        </div>
    </div>

    <!-- Bibliotecas externas -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/hammerjs@2.0.8"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-zoom@2.0.1"></script>    
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@3.0.1/dist/chartjs-plugin-annotation.min.js"></script>

    <script src="EWBclient.js"></script>
    <script src="main.js"></script>
</body>
</html>